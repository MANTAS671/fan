<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
<meta name="theme-color" content="#0b0f14" />
<title>Next Gen 1.2 — Alexey Dash (Mini‑Game)</title>
<style>
  :root{
    --bg:#070b11; --bg2:#0d131c; --ink:#e8f0ff; --muted:#9db0c9; --acc:#7dffb0; --blue:#60a5fa; --rose:#fb7185; --amber:#fbbf24;
    --glass: rgba(255,255,255,.06); --card: rgba(255,255,255,.12); --shadow:0 18px 56px rgba(0,0,0,.5);
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f5f7fb; --bg2:#ffffff; --ink:#0e172a; --muted:#4a5d74; --acc:#22c55e; --blue:#2563eb; --rose:#e11d48; --amber:#d97706; --glass: rgba(0,0,0,.04); --card: rgba(0,0,0,.08); --shadow:0 14px 34px rgba(0,0,0,.16) }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{ margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; color:var(--ink);
    background:radial-gradient(90% 65% at 50% -20%,#112136 0%,transparent 70%), var(--bg);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; -webkit-tap-highlight-color:transparent; touch-action:manipulation;
    display:grid; place-items:center; padding:10px; min-height:100dvh }

  .frame{ width:100%; max-width:680px; background:linear-gradient(180deg,var(--bg2),transparent), var(--glass); border:1px solid var(--card); border-radius:22px; box-shadow:var(--shadow); overflow:hidden; position:relative }
  header{ padding:10px; text-align:center }
  h1{ margin:0; font-size:clamp(20px,5.5vw,28px); font-weight:900; letter-spacing:.3px; background:linear-gradient(90deg,#a7f3d0,#93c5fd,#e9d5ff); -webkit-background-clip:text; background-clip:text; color:transparent }
  .sub{ color:var(--muted); font-size:clamp(12px,3.6vw,14px) }

  .hud{ position:absolute; inset:50px 10px auto; display:flex; justify-content:space-between; align-items:center; gap:8px; pointer-events:none }
  .pill{ background:var(--glass); border:1px solid var(--card); border-radius:999px; padding:6px 10px; display:flex; align-items:center; gap:8px; box-shadow:0 8px 22px rgba(0,0,0,.2) }
  .score{ font-weight:800 }
  .bars{ display:flex; gap:8px }
  .bar{ width:110px; height:10px; background:rgba(255,255,255,.12); border-radius:999px; overflow:hidden; border:1px solid var(--card) }
  .bar > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--amber),var(--rose)); transition:width .2s ease }

  canvas{ width:100%; height:min(72dvh,520px); display:block; background:linear-gradient(180deg,#0c121a 0%, #0c1828 100%); touch-action:none }
  .lanes{ position:absolute; inset:auto 0 0 0; height:4px; background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent); filter:blur(0.2px) }

  .panel{ position:absolute; inset:0; display:grid; place-items:center; background:linear-gradient(180deg,rgba(0,0,0,.28),rgba(0,0,0,.38)); backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px) }
  .card{ background:var(--bg2); border:1px solid var(--card); border-radius:18px; padding:16px; max-width:88%; text-align:center; box-shadow:var(--shadow) }
  .btn{ appearance:none; border:0; cursor:pointer; background:linear-gradient(180deg,var(--acc),#38d47a); color:#061008; font-weight:900; border-radius:14px; padding:12px 14px; min-width:160px; box-shadow:0 10px 24px rgba(50,205,50,.24); font-size:16px }
  .btn.alt{ background:var(--glass); color:var(--ink); border:1px solid var(--card); box-shadow:none }
  .row{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }

  .hint{ position:absolute; bottom:8px; left:50%; transform:translateX(-50%); color:var(--muted); font-size:12px; text-align:center }
  .toast{ position:absolute; top:8px; left:50%; transform:translateX(-50%); background:var(--bg2); border:1px solid var(--card); color:var(--ink); border-radius:12px; padding:8px 10px; display:none }

  @media (max-width:420px){ .hud{ inset:44px 8px auto } .bar{ width:90px } }
  @media (prefers-reduced-motion: reduce){ .toast, .panel{ transition:none !important } }
</style>
</head>
<body>
  <div class="frame" role="application" aria-live="polite">
    <header>
      <h1>Next Gen 1.2 — Alexey Dash</h1>
      <div class="sub">Мини‑игра: уворачивайся от кредиток, собирай апгрейды, береги нервы. Без звука и вибраций.</div>
    </header>

    <div class="hud">
      <div class="pill"><span>Очки:</span> <span class="score" id="score">0</span></div>
      <div class="bars">
        <div class="pill"><span style="font-size:12px">Стресс</span><div class="bar"><i id="stress"></i></div></div>
        <div class="pill"><span style="font-size:12px">Долги</span><div class="bar"><i id="debt"></i></div></div>
      </div>
    </div>

    <canvas id="game" width="720" height="1280" aria-label="Игра: Алексей Даш"></canvas>
    <div class="lanes" aria-hidden="true"></div>

    <div class="hint">Свайп влево/вправо — смена полосы. Тап — ускорение. Пауза — ⏸️ вверху справа.</div>

    <div class="toast" id="toast"></div>

    <div class="panel" id="menu">
      <div class="card">
        <h2 style="margin:0 0 6px">Ты точно не Алексей?</h2>
        <p style="margin:0 0 10px; color:var(--muted)">Раннер про апгрейды и искушения. Выдержишь без кредита?</p>
        <div class="row">
          <button class="btn" id="playBtn">Играть</button>
          <button class="btn alt" id="howBtn">Как играть</button>
        </div>
      </div>
    </div>

    <div class="panel" id="how" hidden>
      <div class="card">
        <h3 style="margin:0 0 8px">Правила</h3>
        <ul style="text-align:left; margin:0 0 8px; padding-left:18px; line-height:1.4">
          <li>Три полосы. Свайпай влево/вправо, чтобы уйти от <b>кредиток</b>.</li>
          <li>Собирай <b>SSD/носочки</b> — это очки и снижение стресса.</li>
          <li><b>Телефоны‑сIREAL</b> — временный щит от одной ошибки.</li>
          <li>Тап по экрану — короткий <b>спринт</b>, но стресс растёт.</li>
          <li>Игра заканчивается, если стресс или долги заполнятся на 100%.</li>
        </ul>
        <div class="row"><button class="btn" id="okBtn">Понял</button></div>
      </div>
    </div>

    <div class="panel" id="gameOver" hidden>
      <div class="card">
        <h2 style="margin:0 0 6px">Финиш!</h2>
        <p style="margin:0 6px; color:var(--muted)">Очки: <b id="finalScore">0</b>. Береги нервы — кредит соблазняет сильнее, чем RGB.</p>
        <div class="row">
          <button class="btn" id="replayBtn">Ещё раз</button>
          <button class="btn alt" id="menuBtn">Меню</button>
        </div>
      </div>
    </div>

  </div>

<script>
// ===== Alexey Dash — Endless Runner (без звука/вибраций) =====
// Простая DOM‑HUD + Canvas‑рендер. Ориентировано на мобилки (iOS/Android).

const W = 720, H = 1280; // базовая логическая сетка, физический размер масштабируем к DPR
const DPR = Math.max(1, Math.min(3, devicePixelRatio || 1));
const cnv = document.getElementById('game');
const ctx = cnv.getContext('2d');
resizeCanvas();

// UI
const scoreEl = document.getElementById('score');
const stressEl = document.getElementById('stress');
const debtEl = document.getElementById('debt');
const menu = document.getElementById('menu');
const how = document.getElementById('how');
const gameOver = document.getElementById('gameOver');
const finalScore = document.getElementById('finalScore');
const toast = document.getElementById('toast');

const playBtn = document.getElementById('playBtn');
const howBtn = document.getElementById('howBtn');
const okBtn = document.getElementById('okBtn');
const replayBtn = document.getElementById('replayBtn');
const menuBtn = document.getElementById('menuBtn');

function show(el){ el.hidden=false; el.style.display='grid' }
function hide(el){ el.hidden=true; el.style.display='none' }

howBtn.onclick = ()=>{ hide(menu); show(how) };
okBtn.onclick = ()=>{ hide(how); show(menu) };
playBtn.onclick = ()=> start();
replayBtn.onclick = ()=> start();
menuBtn.onclick = ()=>{ hide(gameOver); show(menu) };

// Игровые константы и ассеты (картинки‑мемы)
const IMG = {
  alex: mkImg('https://sfile.chatglm.cn/images-ppt/dc68f2522b8a.jpg'),
  ssd: mkImg('https://sfile.chatglm.cn/images-ppt/72d26cd3c9a2.jpg'),
  sock: mkImg('https://sfile.chatglm.cn/images-ppt/94c6e701f06d.png'),
  phone: mkImg('https://sfile.chatglm.cn/images-ppt/590bcaccd076.jpg'),
  credit: mkImg('https://sfile.chatglm.cn/images-ppt/5842861121bb.jpg')
};

function mkImg(src){ const i=new Image(); i.decoding='async'; i.loading='lazy'; i.src=src; return i }

const LANES = [W*0.25, W*0.5, W*0.75];
const SPEED_BASE = 6; // базовая скорость
const SPEED_MAX = 18;
const SPAWN_EVERY = 520; // px по Y между спавнами

let rng = Math.random;

// Состояние игры
let t=0, running=false, lane=1, y=H*0.8, speed=SPEED_BASE, score=0, shield=0;
let stress=0, debt=0; // 0..100
let objects = []; // падающие объекты
let lastSpawn=0;

// Объект: {x,y,type,vy,size}
const T = { SSD:'ssd', SOCK:'sock', PHONE:'phone', CREDIT:'credit' };

function reset(){
  t=0; lane=1; y=H*0.8; speed=SPEED_BASE; score=0; shield=0; stress=8; debt=0; objects= []; lastSpawn=0;
  scoreEl.textContent = '0';
  stressEl.style.width = stress+'%';
  debtEl.style.width = debt+'%';
}

function start(){ hide(menu); hide(gameOver); hide(how); reset(); running=true; loop() }

function gameOverNow(){ running=false; finalScore.textContent = String(score); show(gameOver) }

// Спавн
function spawn(){
  // 60% шанс опасного, 40% — полезного
  const danger = Math.random()<0.6;
  const type = danger ? T.CREDIT : [T.SSD,T.SOCK,T.PHONE][(Math.random()*3)|0];
  const laneIdx = (Math.random()*3)|0;
  const size = (type===T.CREDIT? 120: 100) * (0.9 + Math.random()*0.25);
  const vy = speed * (1.0 + Math.random()*0.2);
  objects.push({x:LANES[laneIdx], y:-size, type, vy, size});
}

// Управление свайпами
let touchX=null, touchY=null;
cnv.addEventListener('pointerdown',e=>{ touchX=e.clientX; touchY=e.clientY; });
cnv.addEventListener('pointerup',e=>{
  if(touchX==null) return; const dx=e.clientX-touchX; const dy=e.clientY-touchY;
  // тап без сдвига — спринт
  if(Math.hypot(dx,dy)<12){ speed = Math.min(SPEED_MAX, speed+4); stress = Math.min(100, stress+6); stressEl.style.width = stress+'%'; hint('Спринт!'); return touchX=null }
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0 && lane<2) lane++; else if(dx<0 && lane>0) lane--; hint('Полоса: '+(lane+1));
  }
  touchX=null
});

// Рендер/логика
function loop(){ if(!running) return; requestAnimationFrame(loop); t+=1;
  // фон
  ctx.clearRect(0,0,cnv.width,cnv.height);
  drawRoad();

  // игрок
  const px = LANES[lane];
  drawPlayer(px,y);

  // объекты
  if((t%Math.max(60, 200 - speed*8))===0 || (H - lastSpawn > SPAWN_EVERY)) { spawn(); lastSpawn=0 }
  lastSpawn += speed*6;

  for(let i=objects.length-1;i>=0;i--){
    const o = objects[i]; o.y += o.vy * 2; drawObj(o);
    if(o.y>H+200) { objects.splice(i,1); continue }
    // столкновения
    const d = Math.hypot(o.x - px, o.y - y);
    if(d < (o.size/2 + 44)){
      collide(o.type); objects.splice(i,1); continue;
    }
  }

  // инерция скорости
  speed += (SPEED_BASE - speed) * 0.02;

  // пассивный стресс от скорости
  stress = Math.min(100, Math.max(0, stress + (speed-SPEED_BASE)*0.02 - 0.015));
  stressEl.style.width = stress.toFixed(1)+'%';

  // очки от пройденного пути
  score += Math.floor(speed*0.6); scoreEl.textContent = String(score);

  // штраф по долгам со временем, если часто спринтуешь
  debt = Math.min(100, Math.max(0, debt + (speed>SPEED_BASE+2? 0.05: 0.01)));
  debtEl.style.width = debt.toFixed(1)+'%';

  if(stress>=100 || debt>=100) return gameOverNow();
}

function drawRoad(){
  // рисуем полосы/разметку параллаксом
  ctx.save();
  const grd = ctx.createLinearGradient(0,0,0,cnv.height);
  grd.addColorStop(0,'#0c121a'); grd.addColorStop(1,'#0c1828');
  ctx.fillStyle = grd; ctx.fillRect(0,0,cnv.width, cnv.height);

  ctx.strokeStyle = 'rgba(255,255,255,.08)'; ctx.lineWidth = 2 * DPR; ctx.setLineDash([16,18]);
  for(let k=0;k<3;k++){ const x=LANES[k]; ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,cnv.height); ctx.stroke() }
  ctx.restore();
}

function drawPlayer(x,y){
  // мем‑портрет в кружке
  const r = 48; ctx.save(); ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI*2); ctx.closePath(); ctx.clip();
  ctx.drawImage(IMG.alex, x-r, y-r, r*2, r*2); ctx.restore();
  // акцентное кольцо
  ctx.strokeStyle = '#7dffb0'; ctx.lineWidth = 4 * DPR; ctx.beginPath(); ctx.arc(x, y, r+2, 0, Math.PI*2); ctx.stroke();
  // щит
  if(shield>0){ ctx.strokeStyle = '#60a5fa'; ctx.lineWidth = 3*DPR; ctx.globalAlpha = 0.8; ctx.beginPath(); ctx.arc(x, y, r+10*Math.sin(perfNow()*0.006)+12, 0, Math.PI*2); ctx.stroke(); ctx.globalAlpha=1 }
}

function drawObj(o){
  const s = o.size; ctx.save(); ctx.beginPath(); ctx.arc(o.x, o.y, s/2, 0, Math.PI*2); ctx.closePath(); ctx.clip();
  const img = IMG[o.type]; if(img && img.complete) ctx.drawImage(img, o.x - s/2, o.y - s/2, s, s);
  ctx.restore();
  // рамка
  ctx.lineWidth = 3 * DPR; ctx.strokeStyle = (o.type===T.CREDIT?'#fb7185': o.type===T.PHONE?'#60a5fa':'#7dffb0');
  ctx.beginPath(); ctx.arc(o.x, o.y, s/2+2, 0, Math.PI*2); ctx.stroke();
}

function collide(type){
  if(type===T.CREDIT){ if(shield>0){ shield=0; ping('Щит спас!'); return } debt = Math.min(100, debt+18); stress=Math.min(100, stress+8); ping('Кредитка: ау!') }
  if(type===T.SSD){ score+=120; stress=Math.max(0, stress-8); ping('SSD +120, −стресс') }
  if(type===T.SOCK){ score+=80; stress=Math.max(0, stress-6); ping('Носочки +80, −стресс') }
  if(type===T.PHONE){ shield=1; ping('Щит: одна ошибка простится') }
  debtEl.style.width = debt+'%'; stressEl.style.width = stress+'%';
}

function ping(text){ toast.textContent=text; toast.style.display='block'; clearTimeout(ping._t); ping._t=setTimeout(()=>toast.style.display='none', 900) }

function hint(text){ ping(text) }

function resizeCanvas(){
  const rect = cnv.getBoundingClientRect();
  cnv.width = Math.floor(rect.width * DPR); cnv.height = Math.floor(rect.height * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0); // логические координаты ~ CSS px
}

window.addEventListener('resize', resizeCanvas, {passive:true});

function perfNow(){ return (performance && performance.now? performance.now(): Date.now()) }

// Авто‑пауза при скрытии вкладки
let vis = true; document.addEventListener('visibilitychange',()=>{ vis = document.visibilityState==='visible'; if(!vis) running=false })
window.addEventListener('focus',()=>{ if(!running && !menu.isConnected && !gameOver.hidden){} })

// Стартовое меню отображается по умолчанию

</script>
</body>
</html>
